<!DOCTYPE html>

<html>

    <head>
        <title>Game</title>
    </head>

    <body>
        <canvas id="canvas">
            Your browser does not support canvas tag.
        </canvas>

        <script>
            var canvas = document.getElementById('canvas');
            var ctx = canvas.getContext('2d');
            var path = "file.mp3";
            var audio = new Audio(path);

            canvas.width = 700;
            canvas.height = 500;


            var mySprite = {
                x: 250,
                y: 470,
                width: 10,
                height: 10,
                speed: 100,
                color: "blue"
            };

            var tool = {
                width: 5,
                height: 5,
                speed: 1000,
                color: "green",
                active: true
            };

            var enemy = {
                x: 105,
                y: 10,
                width: 10,
                height: 10,
                speed: 50,
                color: "yellow"
            };

            var canvas1 = {
                x: 50,
                y: 0,
                width: 10,
                height: 500,
                speed: 50,
                color: "green"
            };

            var canvas2 = {
                x: 90,
                y: 20,
                width: 10,
                height: 500,
                speed: 50,
                color: "green"
            };

            var canvas3 = {
                x: 72,
                y: 400,
                width: 18,
                height: 10,
                color: "green"
            };

            var mob;

            var keysDown = {};

            window.addEventListener('keydown', function(e) {
                keysDown[e.keyCode] = true;
            });

            window.addEventListener('keyup', function(e) {
                delete keysDown[e.keyCode];
            });
            var mobs = new Array();
            for (i = 0; i < 5; i++) {
                mob = {
                    x: Math.floor(Math.random() * 500),
                    y: 150,
                    width: 10,
                    height: 10,
                    speed: 50,
                    color: "orange"
                };
                mobs.push(mob);
            }

            function update(mod) {
                for (i = 0; i < 5; i++) {
                    mobs[i].y += mob.speed * mod;
                }
                if (37 in keysDown) {
                    mySprite.x = mySprite.x - mySprite.speed * mod;
                }
                if (38 in keysDown) {
                    mySprite.y = mySprite.y - mySprite.speed * mod;
                }
                if (39 in keysDown) {
                    mySprite.x = mySprite.x + mySprite.speed * mod;
                }
                if (40 in keysDown) {
                    mySprite.y = mySprite.y + mySprite.speed * mod;
                }
                if (32 in keysDown) {
                    tool.y = tool.y - tool.speed * mod;
                    audio.play();
                    if (tool.y <= mySprite.y - 170) {
                        tool.y = mySprite.y;
                        tool.x = mySprite.x;
                    }
                    tool.active = true;
                } else {
                    tool.y = mySprite.y;
                    tool.x = mySprite.x;
                    tool.active = false;
                }

                if (tool.x < enemy.x + enemy.width &&
                        tool.y < enemy.y + enemy.height &&
                        tool.x > enemy.x - enemy.width &&
                        tool.y > enemy.y - enemy.height) {
                    audio.play();
                    enemy.height = 0;
                    enemy.width = 0;
                }

                else if (tool.x < mob.x + mob.width &&
                        tool.y < mob.y + mob.height &&
                        tool.x > mob.x - mob.width &&
                        tool.y > mob.y - mob.height) {
                    mob.x = 0;
                    mob.y = 0;
                }

            }

            function render() {
                if (mySprite.x < canvas1.x + canvas1.width &&
                        mySprite.y < canvas1.y + canvas1.height &&
                        mySprite.x > canvas1.x - mySprite.width &&
                        mySprite.y > canvas1.y - mySprite.height) {
                    audio.play();
                    restart();
                } else if (mySprite.x < canvas2.x + canvas2.width &&
                        mySprite.y < canvas2.y + canvas2.height &&
                        mySprite.x > canvas2.x - mySprite.width &&
                        mySprite.y > canvas2.y - mySprite.height) {
                    audio.play();
                    restart();
                }
                else if (mySprite.x < canvas3.x + canvas3.width &&
                        mySprite.y < canvas3.y + canvas3.height &&
                        mySprite.x > canvas3.x - mySprite.width &&
                        mySprite.y > canvas3.y - mySprite.height) {
                    audio.play();
                    restart();
                }


                ctx.fillStyle = "cyan";
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                ctx.fillStyle = mySprite.color;
                ctx.fillRect(mySprite.x, mySprite.y, mySprite.width, mySprite.height);
                ctx.fillStyle = canvas1.color;
                ctx.fillRect(canvas1.x, canvas1.y, canvas1.width, canvas1.height);
                ctx.fillStyle = canvas2.color;
                ctx.fillRect(canvas2.x, canvas2.y, canvas2.width, canvas2.height);
                if (tool.active) {
                    ctx.fillRect(tool.x, tool.y, tool.width, tool.height);
                }
                ctx.fillStyle = enemy.color;
                ctx.fillRect(enemy.x, enemy.y, enemy.width, enemy.height);
                ctx.fillStyle = canvas3.color;
                ctx.fillRect(canvas3.x, canvas3.y, canvas3.width, canvas3.height);
                for (i = 0; i < 5; i++) {
                    ctx.fillStyle = mob.color;
                    ctx.fillRect(mobs[i].x, mobs[i].y, mobs[i].width,
                            mobs[i].height);
                }
            }


            var time = Date.now();

            function run() {
                update((Date.now() - time) / 1000);
                time = Date.now();
                render();
            }

            setInterval(run, 10);

            function restart() {
                alert("Sorry!");
                location.reload(true);
            }
        </script>
    </body>

</html>
